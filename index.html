<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8" />
	<title>WebAR Видео на Маркере Hiro - Вертикальное 9:16</title>

	<!-- A-Frame и AR.js -->
	<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
	<script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js@2.2.1/aframe/build/aframe-ar.min.js"></script>

	<style>
		.arjs-debug-ui,
		.arjs-loader,
		.arjs-video,
		.arjs-overlay {
			display: none !important;
		}

		body {
			margin: 0;
			overflow: hidden;
			background: black;
		}

		#crosshair {
			position: fixed;
			top: 50%;
			left: 50%;
			width: 120px;
			height: 120px;
			transform: translate(-50%, -50%);
			pointer-events: none;
			z-index: 10000;
			mix-blend-mode: difference;
		}
	</style>
</head>
<body>
	<!-- Центрированная иконка QR-кода -->
	<img
		id="crosshair"
		src="https://upload.wikimedia.org/wikipedia/commons/4/41/QR_Code_Example.svg"
		alt="QR code icon"
	/>

	<a-scene
		embedded
		vr-mode-ui="enabled: false"
		renderer="logarithmicDepthBuffer: true;"
		arjs="sourceType: environment; debugUIEnabled: false;"
	>
		<a-marker id="marker" type="pattern">
			<!--
				Вертикальное видео с пропорцией 9:16.
				Ширина = 1, высота = 1.777 (16/9)
			-->
			<a-video
				id="ar-video"
				src="video.mp4"
				width="1"
				height="1.777"
				position="0 0 0"
				rotation="-90 0 0"
				muted
				loop
				preload="auto"
				webkit-playsinline
				playsinline
				visible="false"
			></a-video>
		</a-marker>

		<a-entity camera></a-entity>
	</a-scene>

	<script>
		const marker = document.querySelector("#marker");
		const video = document.querySelector("#ar-video");

		video.pause();

		let markerVisible = false;
		let stopTimeout;

		function playVideo() {
			video.setAttribute('visible', true);
			const playPromise = video.play();
			if (playPromise !== undefined) {
				playPromise.catch(() => {
					console.log("Видео автозапуск заблокирован, ждём взаимодействия");
				});
			}
		}

		function stopVideo() {
			video.pause();
			video.currentTime = 0;
			video.setAttribute('visible', false);
		}

		marker.addEventListener("markerFound", () => {
			if (stopTimeout) {
				clearTimeout(stopTimeout);
			}
			if (!markerVisible) {
				markerVisible = true;
				playVideo();
				console.log("Маркер найден, видео запущено");
			}
		});

		marker.addEventListener("markerLost", () => {
			stopTimeout = setTimeout(() => {
				if (markerVisible) {
					markerVisible = false;
					stopVideo();
					console.log("Маркер потерян, видео остановлено");
				}
			}, 1000);
		});

		if (window.ARjs) {
			ARjs.Context.baseURL = "";
			ARjs.debug = false;
		}
	</script>
</body>
</html>
